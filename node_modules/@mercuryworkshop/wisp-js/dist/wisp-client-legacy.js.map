{"version":3,"file":"wisp-client-legacy.js","mappings":"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","sources":["webpack://wisp_client/webpack/bootstrap","webpack://wisp_client/webpack/runtime/define property getters","webpack://wisp_client/webpack/runtime/hasOwnProperty shorthand","webpack://wisp_client/webpack/runtime/make namespace object","webpack://wisp_client/./src/compat_browser.mjs","webpack://wisp_client/./src/packet.mjs","webpack://wisp_client/./src/extensions.mjs","webpack://wisp_client/./src/client/connection.mjs","webpack://wisp_client/./src/client/polyfill.mjs"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","//the node modules referenced by other parts of the code do not exist on the web\n//some of them can be replaced by the standard browser apis, others have to be ignored\n\n//compatibility for old browsers where globalThis doesn't exist\nexport const global_this = typeof globalThis === \"undefined\" ? window : globalThis;\n\nexport const WebSocket = global_this.WebSocket;\nexport const crypto = global_this.crypto;\nexport const WebSocketServer = null;\nexport const net = null;\nexport const dgram = null;\nexport const dns = null;\nexport const http = null;","//shared packet parsing / serialization code\n\nconst text_encoder = new TextEncoder();\nconst encode_text = text_encoder.encode.bind(text_encoder);\nconst text_decoder = new TextDecoder();\nconst decode_text = text_decoder.decode.bind(text_decoder);\n\nexport class WispBuffer {\n  constructor(data) {\n    if (data instanceof Uint8Array) {\n      this.from_array(data);\n    }\n    else if (typeof data === \"number\") {\n      this.from_array(new Uint8Array(data));\n    }\n    else if (typeof data === \"string\") {\n      this.from_array(encode_text(data));\n    }\n    else {\n      console.trace();\n      throw \"invalid data type passed to wisp buffer constructor\";\n    }\n  }\n\n  from_array(bytes) {\n    this.size = bytes.length;\n    this.bytes = bytes;\n    this.view = new DataView(bytes.buffer); \n  }\n\n  concat(buffer) {\n    let new_buffer = new WispBuffer(this.size + buffer.size);\n    new_buffer.bytes.set(this.bytes, 0);\n    new_buffer.bytes.set(buffer.bytes, this.size);\n    return new_buffer;\n  }\n\n  slice(index, size) {\n    let bytes_slice = this.bytes.slice(index, size);\n    return new WispBuffer(bytes_slice);\n  }\n\n  get_string() {\n    return text_decoder.decode(this.bytes);\n  }\n}\n\nexport class WispPacket {\n  static min_size = 5;\n  constructor({type, stream_id, payload, payload_bytes }) {\n    this.type = type;\n    this.stream_id = stream_id;\n    this.payload_bytes = payload_bytes;\n    this.payload = payload;\n  }\n  static parse(buffer) {\n    return new WispPacket({\n      type: buffer.view.getUint8(0),\n      stream_id: buffer.view.getUint32(1, true),\n      payload_bytes: buffer.slice(5)\n    });\n  }\n  static parse_all(buffer) {\n    if (buffer.size < WispPacket.min_size) {\n      throw TypeError(\"packet too small\");\n    }\n    let packet = WispPacket.parse(buffer);\n    let payload_class = packet_classes[packet.type];\n    if (typeof payload_class === \"undefined\") {\n      throw TypeError(\"invalid packet type\");\n    }\n    if (packet.payload_bytes.size < payload_class.size) {\n      throw TypeError(\"payload too small\");\n    }\n    packet.payload = payload_class.parse(packet.payload_bytes);\n    return packet;\n  }\n  serialize() {\n    let buffer = new WispBuffer(5);\n    buffer.view.setUint8(0, this.type);\n    buffer.view.setUint32(1, this.stream_id, true);\n    buffer = buffer.concat(this.payload.serialize());\n    return buffer;\n  }\n}\n\nexport class ConnectPayload {\n  static min_size = 3;\n  static type = 0x01;\n  static name = \"CONNECT\";\n  constructor({stream_type, port, hostname}) {\n    this.stream_type = stream_type;\n    this.port = port;\n    this.hostname = hostname;\n  }\n  static parse(buffer) {\n    return new ConnectPayload({\n      stream_type: buffer.view.getUint8(0),\n      port: buffer.view.getUint16(1, true),\n      hostname: decode_text(buffer.slice(3).bytes)\n    });\n  }\n  serialize() {\n    let buffer = new WispBuffer(3);\n    buffer.view.setUint8(0, this.stream_type);\n    buffer.view.setUint16(1, this.port, true);\n    buffer = buffer.concat(new WispBuffer(this.hostname));\n    return buffer;\n  }\n}\n\nexport class DataPayload {\n  static min_size = 0;\n  static type = 0x02;\n  static name = \"DATA\";\n  constructor({data}) {\n    this.data = data;\n  }\n  static parse(buffer) {\n    return new DataPayload({\n      data: buffer\n    });\n  }\n  serialize() {\n    return this.data;\n  }\n}\n\nexport class ContinuePayload {\n  static type = 0x03;\n  static name = \"CONTINUE\";\n  constructor({buffer_remaining}) {\n    this.buffer_remaining = buffer_remaining;\n  }\n  static parse(buffer) {\n    return new ContinuePayload({\n      buffer_remaining: buffer.view.getUint32(0, true),\n    });\n  }\n  serialize() {\n    let buffer = new WispBuffer(4);\n    buffer.view.setUint32(0, this.buffer_remaining, true);\n    return buffer;\n  }\n}\n\nexport class ClosePayload {\n  static min_size = 1;\n  static type = 0x04;\n  static name = \"CLOSE\";\n  constructor({reason}) {\n    this.reason = reason;\n  }\n  static parse(buffer) {\n    return new ClosePayload({\n      reason: buffer.view.getUint8(0),\n    });\n  }\n  serialize() {\n    let buffer = new WispBuffer(1);\n    buffer.view.setUint8(0, this.reason);\n    return buffer;\n  }\n}\n\nexport class InfoPayload {\n  static min_size = 2;\n  static type = 0x05;\n  static name = \"INFO\";\n  constructor({major_ver, minor_ver, extensions}) {\n    this.major_ver = major_ver;\n    this.minor_ver = minor_ver;\n    this.extensions = extensions;\n  }\n  static parse(buffer) {\n    return new InfoPayload({\n      major_ver: buffer.view.getUint8(0),\n      minor_ver: buffer.view.getUint8(1),\n      extensions: buffer.slice(2)\n    });\n  }\n  serialize() {\n    let buffer = new WispBuffer(2);\n    buffer.view.setUint8(0, this.major_ver);\n    buffer.view.setUint8(1, this.minor_ver);\n    return buffer.concat(this.extensions);\n  }\n}\n\nexport const packet_classes = {\n  0x01: ConnectPayload, \n  0x02: DataPayload, \n  0x03: ContinuePayload, \n  0x04: ClosePayload,\n  0x05: InfoPayload\n}\n\nexport const packet_types = {\n  CONNECT: 0x01,\n  DATA: 0x02,\n  CONTINUE: 0x03,\n  CLOSE: 0x04,\n  INFO: 0x05\n}\n\nexport const stream_types = {\n  TCP: 0x01,\n  UDP: 0x02\n}\n\nexport const close_reasons = {\n  //client/server close reasons\n  Unknown: 0x01,\n  Voluntary: 0x02,\n  NetworkError: 0x03,\n  IncompatibleExtensions: 0x04,\n\n  //server only close reasons\n  InvalidInfo: 0x41, \n  UnreachableHost: 0x42,\n  NoResponse: 0x43,\n  ConnRefused: 0x44,\n  TransferTimeout: 0x47,\n  HostBlocked: 0x48,\n  ConnThrottled: 0x49,\n\n  //client only close reasons\n  ClientError: 0x81,\n\n  //extension specific close reasons\n  AuthBadPassword: 0xc0,\n  AuthBadSignature: 0xc1,\n  AuthMissingCredentials: 0xc2\n}","import { WispBuffer } from \"./packet.mjs\";\n\nclass EmptyPayload {\n  constructor() {}\n  static parse() {\n    return new EmptyPayload();\n  }\n  serialize() {\n    return new WispBuffer(0);\n  }\n}\n\nexport class BaseExtension {\n  static id = 0x00;\n  static name = \"\";\n\n  static Server = EmptyPayload;\n  static Client = EmptyPayload;\n\n  constructor({server_config, client_config} = {}) {\n    this.id = this.constructor.id;\n    this.name = this.constructor.name;\n    if (server_config)\n      this.payload = new this.constructor.Server(server_config);\n    else if (client_config)\n      this.payload = new this.constructor.Client(client_config);\n  }\n  static parse(ext_class, buffer, role) {\n    let extension = new ext_class({});\n    if (role === \"client\")\n      extension.payload = ext_class.Client.parse(buffer.slice(5));\n    else if (role === \"server\")\n      extension.payload = ext_class.Server.parse(buffer.slice(5));\n    else \n      throw TypeError(\"invalid role\");\n    return extension;\n  }\n  serialize() {\n    let buffer = new WispBuffer(5);\n    let payload_buffer = this.payload.serialize();\n    buffer.view.setInt8(0, this.constructor.id);\n    buffer.view.setUint32(1, payload_buffer.size, true);\n    return buffer.concat(payload_buffer);\n  }\n}\n\nexport class UDPExtension extends BaseExtension {\n  static id = 0x01;\n  static name = \"UDP\";\n}\n\nexport class PasswordAuthExtension extends BaseExtension {\n  static id = 0x02;\n  static name = \"Password Authentication\";\n\n  static Server = class {\n    constructor({required = 1}) {\n      this.required = required ? 1 : 0;\n    }\n    static parse(buffer) {\n      return new PasswordAuthExtension.Server({\n        required: buffer.view.getUint8(0)\n      });\n    }\n    serialize() {\n      let buffer = new WispBuffer(1);\n      buffer.view.setUint8(0, this.required);\n      return buffer;\n    }\n  }\n\n  static Client = class {\n    constructor({username, password}) {\n      this.username = username;\n      this.password = password;\n    }\n    static parse(buffer) {\n      let username_len = buffer.view.getUint8(0);\n      let password_len = buffer.view.getUint16(1, true);\n      let password_index = username_len + 3;\n      return new PasswordAuthExtension.Client({\n        username: buffer.slice(3, username_len).get_string(),\n        password: buffer.slice(password_index, password_len).get_string()\n      });\n    }\n    serialize() {\n      let username_buffer = new WispBuffer(this.username);\n      let password_buffer = new WispBuffer(this.password);\n      let buffer = new WispBuffer(3);\n      buffer.view.setUint8(0, username_buffer.size);\n      buffer.view.setUint16(1, password_buffer.size, true);\n      return buffer.concat(username_buffer).concat(password_buffer);\n    }\n  }\n}\n\nexport class MOTDExtension extends BaseExtension {\n  static id = 0x04;\n  static name = \"Server MOTD\";\n\n  static Server = class {\n    constructor({message}) {\n      this.message = message;\n    }\n    static parse(buffer) {\n      return new MOTDExtension.Server({\n        message: buffer.get_string()\n      });\n    }\n    serialize() {\n      return new WispBuffer(this.message);\n    }\n  }\n\n  static Client = EmptyPayload;\n}\n\nexport function parse_extensions(payload_buffer, valid_extensions, role) {\n  let index = 0;\n  let parsed_extensions = [];\n  while (payload_buffer.size) {\n    let ext_id = payload_buffer.view.getUint8(index);\n    let ext_len = payload_buffer.view.getUint32(index + 1, true);\n    let ext_payload = payload_buffer.slice(0, 5 + ext_len);\n    let ext_class;\n    for (let extension of valid_extensions) {\n      if (extension.id !== ext_id) \n        continue;\n      ext_class = extension.constructor;\n      break;\n    }\n    if (ext_class) {\n      let ext_parsed = BaseExtension.parse(ext_class, ext_payload, role);\n      parsed_extensions.push(ext_parsed);\n    }\n    payload_buffer = payload_buffer.slice(5 + ext_len);\n  }\n  return parsed_extensions;\n}\n\nexport function serialize_extensions(extensions) {{\n  let ext_buffer = new WispBuffer(0);\n  for (let extension of extensions) {\n    ext_buffer = ext_buffer.concat(extension.serialize());\n  }\n  return ext_buffer;\n}}\n\nexport const extensions_map = {\n  0x01: UDPExtension,\n  0x02: PasswordAuthExtension,\n  0x04: MOTDExtension\n}","import * as compat from \"../compat.mjs\";\n\nimport {\n  packet_classes,\n  packet_types,\n  stream_types,\n  WispBuffer, \n  WispPacket, \n  ConnectPayload, \n  DataPayload, \n  ClosePayload,\n  InfoPayload\n} from \"../packet.mjs\";\n\nimport { MOTDExtension, UDPExtension, serialize_extensions, parse_extensions } from \"../extensions.mjs\";\n\nclass ClientStream {\n  constructor(hostname, port, websocket, buffer_size, stream_id, connection, stream_type) {\n    this.hostname = hostname;\n    this.port = port;\n    this.ws = websocket;\n    this.buffer_size = buffer_size;\n    this.stream_id = stream_id;\n    this.connection = connection;\n    this.stream_type = stream_type;\n    this.send_buffer = [];\n    this.open = true;\n\n    this.onopen = () => {};\n    this.onclose = () => {};\n    this.onmessage = () => {};\n  }\n\n  send(data) {\n    //note: udp shouldn't buffer anything\n    if (this.buffer_size > 0 || !this.open || this.stream_type === stream_types.UDP) {\n      //construct and send a DATA packet\n      let packet = new WispPacket({\n        type: packet_types.DATA,\n        stream_id: this.stream_id,\n        payload: new DataPayload({\n          data: new WispBuffer(data)\n        })\n      });\n      this.ws.send(packet.serialize().bytes);\n      this.buffer_size--;\n    }\n    else { //server is slow, don't send data yet\n      this.send_buffer.push(data);\n    }\n  }\n\n  //handle receiving a CONTINUE packet\n  continue_received(buffer_size) {\n    this.buffer_size = buffer_size;\n    //send buffered data now\n    while (this.buffer_size > 0 && this.send_buffer.length > 0) {\n      this.send(this.send_buffer.shift());\n    }\n  }\n\n  //construct and send a CLOSE packet\n  close(reason = 0x01) {\n    if (!this.open) return;\n    let packet = new WispPacket({\n      type: packet_types.CLOSE,\n      stream_id: this.stream_id,\n      payload: new ClosePayload({\n        reason: reason\n      })\n    });\n    this.ws.send(packet.serialize().bytes);\n    this.open = false;\n    delete this.connection.active_streams[this.stream_id];\n  }\n}\n\nexport class ClientConnection {\n  constructor(wisp_url, {wisp_version, wisp_extensions} = {}) {\n    if (!wisp_url.endsWith(\"/\")) {\n      throw new TypeError(\"wisp endpoints must end with a trailing forward slash\");\n    }\n\n    this.wisp_url = wisp_url;\n    this.wisp_version = wisp_version || 2;\n    this.wisp_extensions = wisp_extensions || null;\n\n    this.max_buffer_size = null;\n    this.active_streams = {};\n    this.connected = false;\n    this.connecting = false;\n    this.next_stream_id = 1;\n\n    this.server_exts = {};\n    this.client_exts = {};\n    this.info_received = false;\n    this.server_motd = null;\n    this.udp_enabled = true;\n\n    this.onopen = () => {};\n    this.onclose = () => {};\n    this.onerror = () => {};\n    this.onmessage = () => {};\n\n    if (this.wisp_version === 2 && this.wisp_extensions === null) {\n      this.add_extensions();\n    }\n\n    this.connect_ws();\n  }\n\n  add_extensions() {\n    this.wisp_extensions = [];\n    this.wisp_extensions.push(new UDPExtension({client_config: {}}));\n    this.wisp_extensions.push(new MOTDExtension({client_config: {}}));\n  }\n\n  connect_ws() {\n    let subprotocol = this.wisp_version === 2 ? \"wisp-v2\" : undefined;\n    this.ws = new compat.WebSocket(this.wisp_url, subprotocol);\n    this.ws.binaryType = \"arraybuffer\";\n    this.connecting = true;\n\n    this.ws.onerror = () => {\n      if (this.wisp_version === 2) {\n        this.ws.onclose = null;\n        this.cleanup();\n        this.wisp_version = 1;\n        this.connect_ws();\n        return;\n      }\n      this.cleanup();\n      this.onerror();\n    };\n    this.ws.onclose = () => {\n      this.cleanup();\n      this.onclose();\n    };\n    this.ws.onmessage = (event) => {\n      this.on_ws_msg(event);\n      if (this.connected && this.connecting) {\n        this.connecting = false;\n        this.onopen();\n      }\n    };\n  }\n\n  close() {\n    this.ws.close();\n  }\n\n  create_stream(hostname, port, type=0x01) {\n    let stream_type = type;\n    if (typeof stream_type === \"string\") \n      stream_type = type === \"udp\" ? stream_types.UDP : stream_types.TCP;\n\n    if (stream_type == stream_types.UDP && !this.udp_enabled) {\n      throw new Error(\"udp is not enabled for this wisp connection\");\n    }\n\n    let stream_id = this.next_stream_id++;\n    let stream = new ClientStream(hostname, port, this.ws, this.max_buffer_size, stream_id, this, stream_type);\n    this.active_streams[stream_id] = stream;\n    stream.open = this.connected;\n\n    //construct CONNECT packet\n    let packet = new WispPacket({\n      type: packet_types.CONNECT,\n      stream_id: stream_id,\n      payload: new ConnectPayload({\n        stream_type: stream_type,\n        port: port,\n        hostname: hostname\n      })\n    });\n    this.ws.send(packet.serialize().bytes);\n    return stream;\n  }\n\n  close_stream(stream, reason) {\n    stream.onclose(reason);\n    delete this.active_streams[stream.stream_id];\n  }\n\n  on_ws_msg(event) {\n    let buffer = new WispBuffer(new Uint8Array(event.data));\n    if (buffer.size < WispPacket.min_size) {\n      console.warn(`wisp client warning: received a packet which is too short`);\n      return;\n    }\n    let packet = WispPacket.parse_all(buffer);\n    let stream = this.active_streams[packet.stream_id];\n    if (packet.stream_id === 0 && this.connecting) {\n      if (packet.type === packet_types.CONTINUE) {\n        this.max_buffer_size = packet.payload.buffer_remaining;\n        this.connected = true;\n        if (!this.info_received) {\n          this.wisp_version = 1;\n        }\n      }\n      \n      if (packet.type === packet_types.INFO && this.wisp_version === 2) {\n        let server_extensions = parse_extensions(packet.payload.extensions, this.wisp_extensions, \"server\");\n        for (let server_ext of server_extensions) {\n          for (let client_ext of this.wisp_extensions) {\n            if (server_ext.id === client_ext.id) {\n              this.server_exts[server_ext.id] = server_ext;\n              this.client_exts[client_ext.id] = client_ext;\n            }\n          }\n        }\n\n        this.info_received = true; \n        this.server_motd = this.server_exts[MOTDExtension.id]?.payload?.message;\n        this.udp_enabled = !!this.server_exts[UDPExtension.id];\n\n        let ext_buffer = serialize_extensions(this.wisp_extensions);\n        let info_packet = new WispPacket({\n          type: InfoPayload.type,\n          stream_id: 0,\n          payload: new InfoPayload({\n            major_ver: this.wisp_version,\n            minor_ver: 0,\n            extensions: ext_buffer\n          })\n        });\n        this.ws.send(info_packet.serialize().bytes);\n      }\n      return;\n    }\n\n    if (typeof stream === \"undefined\") {\n      console.warn(`wisp client warning: received a ${packet_classes[packet.type].name} packet for a stream which doesn't exist`);\n      return;\n    }\n\n    if (packet.type === packet_types.DATA) {\n      stream.onmessage(packet.payload_bytes.bytes);\n    }\n\n    else if (packet.type === packet_types.CONTINUE) { //other CONTINUE packets\n      stream.continue_received(packet.payload.buffer_remaining);\n    }\n\n    else if (packet.type === packet_types.CLOSE) {\n      this.close_stream(stream, packet.payload.reason);\n    }\n\n    else {\n      console.warn(`wisp client warning: received an invalid packet of type ${packet.type}`);\n    }\n  }\n\n  cleanup() {\n    this.connected = false;\n    this.connecting = false;\n    for (let stream_id of Object.keys(this.active_streams)) {\n      this.close_stream(this.active_streams[stream_id], 0x03);\n    }\n  }\n}\n\n","import { global_this } from \"../compat.mjs\";\nimport { ClientConnection } from \"./connection.mjs\";\n\n//polyfill the DOM Websocket API so that applications using wsproxy can easily use wisp with minimal changes\n\nconst RealCloseEvent = (global_this.CloseEvent || Event);\nexport const _wisp_connections = {};\n\nexport class WispWebSocket extends EventTarget {\n  constructor(url, protocols=null, options = {}) {\n    super();\n    this.url = url;\n    this.protocols = protocols;\n    this.options = options;\n    this.binaryType = \"blob\";\n    this.stream = null;\n    this.connection = null;\n\n    //legacy event handlers\n    this.onopen = () => {};\n    this.onerror = () => {};\n    this.onmessage = () => {};\n    this.onclose = () => {};\n\n    this.CONNECTING = 0;\n    this.OPEN = 1;\n    this.CLOSING = 2;\n    this.CLOSED = 3;\n    this._ready_state = this.CONNECTING;\n\n    //parse the wsproxy url\n    let url_split = this.url.split(\"/\");\n    let wsproxy_path = url_split.pop().split(\":\");\n    this.host = wsproxy_path[0];\n    this.port = parseInt(wsproxy_path[1]);\n    this.real_url = url_split.join(\"/\") + \"/\";\n\n    this.init_connection();\n  }\n\n  on_conn_close() {\n    this._ready_state = this.CLOSED;\n    if (_wisp_connections[this.real_url]) {\n      this.onerror(new Event(\"error\"));\n      this.dispatchEvent(new Event(\"error\"));\n    }\n    delete _wisp_connections[this.real_url];\n  }\n\n  init_connection() {\n    //create the stream\n    this.connection = _wisp_connections[this.real_url];\n\n    if (!this.connection) {\n      this.connection = new ClientConnection(this.real_url, this.options);\n      this.connection.onopen = () => {\n        this.init_stream();\n      };\n      this.connection.onclose = () => {\n        this.on_conn_close()\n      };\n      this.connection.onerror = () => {\n        this.on_conn_close()\n      };\n      _wisp_connections[this.real_url] = this.connection;\n    }\n    else if (!this.connection.connected) {\n      let old_onopen = this.connection.onopen;\n      this.connection.onopen = () => {\n        old_onopen();\n        this.init_stream();\n      };\n    }\n    else {\n      this.connection = _wisp_connections[this.real_url];\n      this.init_stream();\n    }\n  }\n\n  init_stream() {\n    this._ready_state = this.OPEN;\n    this.stream = this.connection.create_stream(this.host, this.port);\n\n    this.stream.onmessage = (raw_data) => {\n      let data;\n      if (this.binaryType == \"blob\") {\n        data = new Blob(raw_data);\n      }\n      else if (this.binaryType == \"arraybuffer\") {\n        data = raw_data.buffer;\n      }\n      else {\n        throw \"invalid binaryType string\";\n      }\n      let msg_event = new MessageEvent(\"message\", {data: data});\n      this.onmessage(msg_event);\n      this.dispatchEvent(msg_event);\n    };\n\n    this.stream.onclose = (reason) => {\n      this._ready_state = this.CLOSED;\n      let close_event = new RealCloseEvent(\"close\", {code: reason}); \n      this.onclose(close_event);\n      this.dispatchEvent(close_event);\n    };\n\n    let open_event = new Event(\"open\");\n    this.onopen(open_event);\n    this.dispatchEvent(open_event);\n  }\n\n  send(data) {\n    let data_array;\n\n    if (data instanceof Uint8Array) {\n      data_array = data;  \n    }\n    else if (typeof data === \"string\") {\n      data_array = new TextEncoder().encode(data);\n    }\n    else if (data instanceof Blob) {\n      data.arrayBuffer().then(array_buffer => {\n        this.send(array_buffer);\n      });\n      return;\n    }\n    else if (data instanceof ArrayBuffer) {\n      data_array = new Uint8Array(data);\n    }\n    //dataview objects or any other typedarray\n    else if (ArrayBuffer.isView(data)) {\n      data_array = new Uint8Array(data.buffer);\n    }\n    else {\n      throw \"invalid data type to be sent\";\n    }\n\n    if (!this.stream) {\n      throw \"websocket is not ready\";\n    }\n    this.stream.send(data_array);\n  }\n\n  close() {\n    this.stream.close(0x02);\n  }\n\n  get bufferedAmount() {\n    let total = 0;\n    for (let msg of this.stream.send_buffer) {\n      total += msg.length;\n    }\n    return total;\n  }\n\n  get extensions() {\n    return \"\";\n  }\n\n  get protocol() {\n    return \"binary\";\n  }\n\n  get readyState() {\n    return this._ready_state;\n  }\n}"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","global_this","globalThis","window","WebSocket","crypto","text_encoder","TextEncoder","encode_text","encode","bind","text_decoder","TextDecoder","decode_text","decode","WispBuffer","constructor","data","Uint8Array","this","from_array","console","trace","bytes","size","length","view","DataView","buffer","concat","new_buffer","set","slice","index","bytes_slice","get_string","WispPacket","_ref","type","stream_id","payload","payload_bytes","parse","getUint8","getUint32","parse_all","min_size","TypeError","packet","payload_class","packet_classes","serialize","setUint8","setUint32","_defineProperty","ConnectPayload","_ref2","stream_type","port","hostname","getUint16","setUint16","DataPayload","_ref3","ContinuePayload","_ref4","buffer_remaining","ClosePayload","_ref5","reason","InfoPayload","_ref6","major_ver","minor_ver","extensions","packet_types","CONNECT","DATA","CONTINUE","CLOSE","INFO","stream_types","TCP","UDP","close_reasons","Unknown","Voluntary","NetworkError","IncompatibleExtensions","InvalidInfo","UnreachableHost","NoResponse","ConnRefused","TransferTimeout","HostBlocked","ConnThrottled","ClientError","AuthBadPassword","AuthBadSignature","AuthMissingCredentials","EmptyPayload","BaseExtension","server_config","client_config","arguments","undefined","id","name","Server","Client","ext_class","role","extension","payload_buffer","setInt8","UDPExtension","PasswordAuthExtension","_PasswordAuthExtension","required","username","password","username_len","password_len","password_index","username_buffer","password_buffer","MOTDExtension","parse_extensions","valid_extensions","parsed_extensions","ext_id","ext_len","ext_payload","ext_parsed","push","serialize_extensions","ext_buffer","_MOTDExtension","message","extensions_map","ClientStream","websocket","buffer_size","connection","ws","send_buffer","open","onopen","onclose","onmessage","send","continue_received","shift","close","active_streams","ClientConnection","wisp_url","wisp_version","wisp_extensions","endsWith","max_buffer_size","connected","connecting","next_stream_id","server_exts","client_exts","info_received","server_motd","udp_enabled","onerror","add_extensions","connect_ws","subprotocol","compat","binaryType","cleanup","event","on_ws_msg","create_stream","Error","stream","close_stream","warn","_this$server_exts$MOT","server_extensions","server_ext","client_ext","info_packet","keys","RealCloseEvent","CloseEvent","Event","_wisp_connections","WispWebSocket","EventTarget","url","protocols","options","super","CONNECTING","OPEN","CLOSING","CLOSED","_ready_state","url_split","split","wsproxy_path","pop","host","parseInt","real_url","join","init_connection","on_conn_close","dispatchEvent","init_stream","old_onopen","raw_data","Blob","msg_event","MessageEvent","close_event","code","open_event","data_array","arrayBuffer","then","array_buffer","ArrayBuffer","isView","bufferedAmount","total","msg","protocol","readyState"],"ignoreList":[],"sourceRoot":""}